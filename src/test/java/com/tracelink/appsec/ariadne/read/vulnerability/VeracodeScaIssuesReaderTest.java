package com.tracelink.appsec.ariadne.read.vulnerability;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.List;
import java.util.Map.Entry;
import org.junit.Assert;
import org.junit.Test;

public class VeracodeScaIssuesReaderTest {

	private static final String RESOURCES = "src/test/resources/";

	@Test
	public void testReadVulnerabilities() throws IOException {
		VulnerabilityReader reader = new VeracodeScaIssuesReader(
				RESOURCES + "vulnerability/veracode-sca-issues.csv");
		List<Entry<String, Integer>> vulnerabilities = reader.readVulnerabilities();

		Assert.assertEquals(1, vulnerabilities.size());
		Entry<String, Integer> entry = vulnerabilities.get(0);
		Assert.assertEquals("org.third.party:library-a:1.0.0", entry.getKey());
		Assert.assertEquals(2, entry.getValue(), 0.001);
	}

	@Test
	public void testConstructorFileNotFound() {
		try {
			new VeracodeScaIssuesReader(RESOURCES + "foo.csv");
		} catch (FileNotFoundException e) {
			Assert.assertEquals("Please provide a valid path to the Veracode SCA issues data",
					e.getMessage());
		}
	}
}
